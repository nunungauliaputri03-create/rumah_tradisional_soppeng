<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tur Virtual Rumah Tradisional Soppeng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <link rel="stylesheet" href="styles/vtour.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

</head>
<body>
<div class="top-bar">
  <a href="index.html" class="go-home">← Kembali ke Beranda</a>
  <h3 class="page-title">Pannellum Virtual Tour (Scenes 0 → 4)</h3>
  <div class="top-bar__actions">
    <button class="minimap-btn" onclick="showMinimap()">Tampilkan Minimap</button>
    <button id="toggleDragBtn" class="minimap-btn">Nonaktifkan Drag</button>
  </div>
</div>

<!-- Modal Minimap -->
<div id="minimapModal" class="minimap-modal" onclick="hideMinimap()">
  <img src= "assets/images/minimap.png" alt="Minimap Virtual Tour" class="minimap-img">
</div>

<div id="panorama"></div>
<div class="scenes">
    <!-- Static scene buttons without any loop -->
    <button onclick="viewer.loadScene('s0')">0</button>
    <button onclick="viewer.loadScene('s1')">1</button>
    <button onclick="viewer.loadScene('s2')">2</button>
    <button onclick="viewer.loadScene('s3')">3</button>
    <button onclick="viewer.loadScene('s4')">4</button>
</div>

<script>
// === Konfigurasi manual dengan hotspot eksplisit ===
var viewer = pannellum.viewer('panorama', {
    "default": {
        "firstScene": "s0",
        "autoLoad": true,
        "showControls": true
    },

    "scenes": {
        "s0": {
            "title": "bagian bawah",
            "type": "equirectangular",
            "panorama": "assets/360_images/bagian bawah.jpg",
            "pitch": 10,
            "hfov": 120,
            "hotSpots": [
                { "pitch": 10, "yaw": -3, "type": "scene", "sceneId": "s1", "text": "bagian dalam (1)" }
            ]
        },

        "s1": {
            "title": "bagian dalam (1)",
            "type": "equirectangular",
            "panorama": "assets/360_images/bagian dalam (1).jpg",
            "pitch": 10,
            "hfov": 120,
            "hotSpots": [
                { "pitch": 0, "yaw": 0, "type": "scene", "sceneId": "s2", "text": "bagian dalam (2)" }
            ]
        },

        "s2": {
            "title": "bagian dalam (2)",
            "type": "equirectangular",
            "panorama": "assets/360_images/bagian dalam (2).jpg",
            "hfov": 120,
            "hotSpots": [
                { "pitch": 0, "yaw": 0, "type": "scene", "sceneId": "s3", "text": "bagian depan tangga" }
            ]
        },

        "s3": {
            "title": "bagian depan tangga",
            "type": "equirectangular",
            "panorama": "assets/360_images/bagian depan tangga.jpg",
            "hfov": 120,
            "yaw": -180,
            "hotSpots": [
                { "pitch": 0, "yaw": -220, "type": "scene", "sceneId": "s4", "text": "bagian depan" }
            ]
        },

        "s4": {
            "title": "bagian depan",
            "type": "equirectangular",
            "panorama": "assets/360_images/bagian depan.jpg",
            "hfov": 120,
            "hotSpots": [
                { "pitch": 0, "yaw": 0, "type": "scene", "sceneId": "s0", "text": "bagian bawah" }
            ]
        }
    }
});

// Fungsi untuk menampilkan modal minimap
  function showMinimap() {
    document.getElementById('minimapModal').classList.add('active');
  }
  function hideMinimap() {
    document.getElementById('minimapModal').classList.remove('active');
  }

  // === Menampilkan koordinat pitch dan yaw saat panorama di-klik ===
  const panoramaEl = document.getElementById('panorama');
  const coordDiv = document.createElement('div');
  coordDiv.className = 'coord-hint';
  coordDiv.textContent = 'Klik panorama untuk koordinat';
  if (panoramaEl) {
    panoramaEl.appendChild(coordDiv);
  } else {
    document.body.appendChild(coordDiv);
  }
  const toggleBtn = document.getElementById('toggleDragBtn');
  const viewerContainer = typeof viewer.getContainer === 'function'
    ? viewer.getContainer()
    : panoramicFallback();

  let dragEnabled = true;

  function panoramicFallback() {
    return panoramaEl.querySelector('.pnlm-container') || panoramaEl;
  }

  function setCoordHint(message) {
    coordDiv.textContent = message;
  }

  function showCoords(event) {
    const coords = viewer.mouseEventToCoords(event);
    if (coords && Number.isFinite(coords.yaw) && Number.isFinite(coords.pitch)) {
      coordDiv.textContent = Yaw: ${coords.yaw.toFixed(2)}, Pitch: ${coords.pitch.toFixed(2)};
    } else {
      const fallbackYaw = typeof viewer.getYaw === 'function' ? viewer.getYaw() : NaN;
      const fallbackPitch = typeof viewer.getPitch === 'function' ? viewer.getPitch() : NaN;
      if (Number.isFinite(fallbackYaw) && Number.isFinite(fallbackPitch)) {
        coordDiv.textContent = Yaw: ${fallbackYaw.toFixed(2)}, Pitch: ${fallbackPitch.toFixed(2)};
      } else {
        setCoordHint('Tidak dapat membaca koordinat');
      }
    }
  }

  function handlePointer(event) {
    if (!dragEnabled) {
      showCoords(event);
      event.stopPropagation();
      event.preventDefault();
    }
  }

  function handleScroll(event) {
    if (!dragEnabled) {
      event.stopPropagation();
      event.preventDefault();
    }
  }

  const wheelListenerOptions = { capture: true, passive: false };

  function disableDrag() {
    dragEnabled = false;
    panoramaEl.style.cursor = 'pointer';
    viewerContainer.style.cursor = 'pointer';
    viewerContainer.addEventListener('mousedown', handlePointer, true);
    viewerContainer.addEventListener('touchstart', handlePointer, true);
    viewerContainer.addEventListener('click', handlePointer, true);
    viewerContainer.addEventListener('touchend', handlePointer, true);
    viewerContainer.addEventListener('wheel', handleScroll, wheelListenerOptions);
    toggleBtn.textContent = 'Aktifkan Drag';
    setCoordHint('Mode koordinat aktif — klik panorama');
  }

  function enableDrag() {
    dragEnabled = true;
    panoramaEl.style.cursor = 'grab';
    viewerContainer.style.cursor = 'grab';
    viewerContainer.removeEventListener('mousedown', handlePointer, true);
    viewerContainer.removeEventListener('touchstart', handlePointer, true);
    viewerContainer.removeEventListener('click', handlePointer, true);
    viewerContainer.removeEventListener('touchend', handlePointer, true);
    viewerContainer.removeEventListener('wheel', handleScroll, wheelListenerOptions);
    toggleBtn.textContent = 'Nonaktifkan Drag';
    setCoordHint('Klik panorama untuk koordinat');
  }

  toggleBtn.onclick = function() {
    if (dragEnabled) {
      disableDrag();
    } else {
      enableDrag();
    }
  };

  // Set cursor awal dan pesan bawaan
  enableDrag();

  document.addEventListener('click', () => {
    document.querySelectorAll('.hotspot-alert.is-open').forEach((node) => node.classList.remove('is-open'));
  });
</script>

</body>
</html>